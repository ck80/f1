<h2 align=center><%= @year %> Tips</h2>

<script type="text/javascript" id="js">$(document).ready(function() {
  // call the tablesorter plugin
  $("table").tablesorter({
    // sort on the first column and third column, order asc
    sortList: [[1,0],[11,1]]
  });
});
</script>

<style>
.carousel-control-prev-icon {
    background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 8 8'%3E%3Cpath d='M5.25 0l-4 4 4 4 1.5-1.5-2.5-2.5 2.5-2.5-1.5-1.5z'/%3E%3C/svg%3E");
}

.carousel-control-next-icon {
    background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 8 8'%3E%3Cpath d='M2.75 0l-1.5 1.5 2.5 2.5-2.5 2.5 1.5 1.5 4-4-4-4z'/%3E%3C/svg%3E");
}
</style>

<% @race=Race.where(year: @year).order(race_number: :asc) %>
<% @next_race= Race.where("ical_dtstart >= ?", Time.now).order(ical_dtstart: :asc).first%>

<div id="TipControls" class="carousel slide" data-ride="carousel" data-interval="false">
  <div class="carousel-inner">
      <% @race.each do |r| %>
      <% if r.race_number == @next_race.race_number then %>
        <div class="carousel-item active" style="overflow-x:auto;">
      <% else %>
        <div class="carousel-item" style="overflow-x:auto;">
      <% end %>
      <h5 align=center>Race <%= r.race_number.to_s + " - " + r.country  %></h5>
      
      <table class="TFtable" data-toggle="table">
        <thead class="TFtable">
          <th style="text-align:center; border-left:#4e95f4 1px solid; border-top:#4e95f4 1px solid; border-right:#4e95f4 1px solid; border-bottom-style:hidden; border-bottom-color: transparent">User</th>
          <th style="text-align:center; border-left:#4e95f4 1px solid; border-top:#4e95f4 1px solid; border-right:#4e95f4 1px solid; border-bottom-style:hidden; border-bottom-color: transparent">Race</th>
          <th style="text-align:center; border-left:#4e95f4 1px solid; border-top:#4e95f4 1px solid; border-right:#4e95f4 1px solid; border-bottom-style:hidden; border-bottom-color: transparent">Country</th>
          <th colspan="3" style="text-align:center; border:#4e95f4 1px solid">Qualificaitons</th>
          <th colspan="4" style="text-align:center; border:#4e95f4 1px solid">Race</th>
          <th style="text-align:center; border-left:#4e95f4 1px solid; border-top:#4e95f4 1px solid; border-right:#4e95f4 1px solid; border-bottom-style:hidden; border-bottom-color: transparent">Score</th>
          <th colspan="3" style="text-align:center; border-left:#4e95f4 1px solid; border-top:#4e95f4 1px solid; border-right:#4e95f4 1px solid; border-bottom-style:hidden; border-bottom-color: transparent">Actions</th>
        </thead>
        <thead class="TFtable">
          <tr class="TFtable">
            <th style="text-align:center; border-left:#4e95f4 1px solid; border-bottom:#4e95f4 1px solid; border-right:#4e95f4 1px solid; border-top-style:hidden; border-top-color: transparent"></th>
            <th style="text-align:center; border-left:#4e95f4 1px solid; border-bottom:#4e95f4 1px solid; border-right:#4e95f4 1px solid; border-top-style:hidden; border-top-color: transparent"></th>
            <th style="text-align:center; border-left:#4e95f4 1px solid; border-bottom:#4e95f4 1px solid; border-left:#4e95f4 1px solid; border-top-style:hidden; border-top-color: transparent"></th>
            <th style="text-align:center; border:#4e95f4 1px solid">Q1</th>
            <th style="text-align:center; border:#4e95f4 1px solid">Q2</th>
            <th style="text-align:center; border:#4e95f4 1px solid">Q3</th>
            <th style="text-align:center; border:#4e95f4 1px solid">R1</th>
            <th style="text-align:center; border:#4e95f4 1px solid">R2</th>
            <th style="text-align:center; border:#4e95f4 1px solid">R3</th>
            <th style="text-align:center; border:#4e95f4 1px solid">R10</th>
            <th style="text-align:center; border-left:#4e95f4 1px solid; border-bottom:#4e95f4 1px solid; border-right:#4e95f4 1px solid; border-top-style:hidden; border-top-color: transparent"></th>
            <th colspan="3" style="text-align:center; border-left:#4e95f4 1px solid; border-bottom:#4e95f4 1px solid; border-left:#4e95f4 1px solid; border-top-style:hidden; border-top-color: transparent"></th>
          </tr>
        </thead>
        <tbody>
          <% @tips = Tip.joins(:race).where("races.year = ? AND user_id = ? AND race_id = ?", @year, @user.id, r.id) %>
          <% @tips = @tips + Tip.joins(:race).where("races.year = ? AND races.ical_dtstart < ? AND user_id != ? AND race+id = ?", @year, Time.current, @user.id, r.id) %>
          <% @tips.where(race_id: r.id).each do |tip| %>
            <tr>
              <td><%= tip.user.name %></td>
              <td style="text-align:center"><%= tip.race.race_number %></td>
              <td><%= tip.race.country %></td>
              <td style="color:<%= if tip.qual_first_points == nil then "black" elsif tip.qual_first_points == Point.find_by(item: "q1st").points then "#2a8e01" elsif tip.qual_first_points == 0 then "#e20202" elsif tip.qual_first_points > 0 then "#0792ef" end %>" ><%= tip.qual_first %> | <%= tip.qual_first_points %></td>
              <td style="color:<%= if tip.qual_second_points == nil then "black" elsif tip.qual_second_points == Point.find_by(item: "q2nd").points then "#2a8e01" elsif tip.qual_second_points == 0 then "#e20202" elsif tip.qual_second_points > 0 then "#0792ef" end %>" ><%= tip.qual_second %> | <%= tip.qual_second_points %></td>
              <td style="color:<%= if tip.qual_third_points == nil then "black" elsif tip.qual_third_points == Point.find_by(item: "q3rd").points then "#2a8e01" elsif tip.qual_third_points == 0 then "#e20202" elsif tip.qual_third_points > 0 then "#0792ef" end %>" ><%= tip.qual_third %> | <%= tip.qual_third_points %></td>
              <td style="color:<%= if tip.race_first_points == nil then "black" elsif tip.race_first_points == Point.find_by(item: "r1st").points then "#2a8e01" elsif tip.race_first_points == 0 then "#e20202" elsif tip.race_first_points > 0 then "#0792ef" end %>" ><%= tip.race_first %> | <%= tip.race_first_points %></td>
              <td style="color:<%= if tip.race_second_points == nil then "black" elsif tip.race_second_points == Point.find_by(item: "r2nd").points then "#2a8e01" elsif tip.race_second_points == 0 then "#e20202" elsif tip.race_second_points > 0 then "#0792ef" end %>" ><%= tip.race_second %> | <%= tip.race_second_points %></td>
              <td style="color:<%= if tip.race_third_points == nil then "black" elsif tip.race_third_points == Point.find_by(item: "r3rd").points then "#2a8e01" elsif tip.race_third_points == 0 then "#e20202" elsif tip.race_third_points > 0 then "#0792ef" end %>" ><%= tip.race_third %> | <%= tip.race_third_points %></td>
              <td style="color:<%= if tip.race_tenth_points == nil then "black" elsif tip.race_tenth_points == Point.find_by(item: "r10th_bonus").points then "#2a8e01" elsif tip.race_tenth_points == 0 then "#e20202" elsif tip.race_tenth_points > 0 then "#0792ef" end %>" ><%= tip.race_tenth %> | <%= tip.race_tenth_points %></td>
              <td style="text-align:center"><%= tip.race_total_points %></td>
              <% if current_user.admin? %>
              <td><%= link_to 'Show', tip_path(id: tip) %></td>
              <% end %>
              <td><%= if tip.race.ical_dtstart.future? then link_to 'Edit', edit_tip_path(id: tip) else "Closed" end %></td>
              <% if current_user.admin? %>
              <td><%= link_to 'Delete', tip_path(id: tip), method: :delete, data: { confirm: 'Are you sure?' }, class:"btn btn-danger" %></td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <% end %>
  </div>
  <a class="carousel-control-prev" href="#TipControls" role="button" data-slide="prev" style="bottom: 100%;">
    <span class="carousel-control-prev-icon" aria-hidden="true" style="background-image: url(&quot;data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='#339DFF' viewBox='0 0 8 8'%3E%3Cpath d='M5.25 0l-4 4 4 4 1.5-1.5-2.5-2.5 2.5-2.5-1.5-1.5z'/%3E%3C/svg%3E&quot;);"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#TipControls" role="button" data-slide="next" style="bottom: 100%;">
    <span class="carousel-control-next-icon" aria-hidden="true" style="background-image: url(&quot;data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='#339DFF' viewBox='0 0 8 8'%3E%3Cpath d='M2.75 0l-1.5 1.5 2.5 2.5-2.5 2.5 1.5 1.5 4-4-4-4z'/%3E%3C/svg%3E&quot;);"></span>
    <span class="sr-only">Next</span>
  </a>

  
</br>

<%= link_to 'New Tip', new_tip_path, class: "btn btn-primary"%>

</div>


